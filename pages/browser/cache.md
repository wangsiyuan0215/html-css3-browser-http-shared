---
level: 2
---

# 缓存机制

浏览器缓存机制是浏览器用来缓存资源的一种机制，它可以减少网络传输，提高网页加载速度。

主要有两种缓存机制：

<v-click>

- 强缓存
- 协商缓存

<br />

## 强缓存

强缓存是利用 `Expires` 或 `Cache-Control` 响应头来控制的，它告诉浏览器在缓存期间不需要请求，直接使用缓存即可。

- 第一次请求资源，不存在缓存结果和缓存标识，直接从服务器获取资源；
- 存在缓存结果和缓存标识，但是过期失效，使用**协商缓存**；
- 存在缓存结果和缓存标识，且未过期有效，则直接从缓存中获取结果返回；
- `Expires` 或 `Cache-Control` 记录资源的过期时间。

</v-click>

---
level: 2
hideInToc: true
---

# 协商缓存

协商缓存是利用 `Last-Modified` 或 `ETag` 响应头来控制的，浏览器在请求时会携带 `If-Modified-Since` 或 `If-None-Match` 头信息，服务器会根据这个信息判断是否命中协商缓存。

- 协商缓存生效，返回 304 和 `Not Modified`；
- 协商缓存失效，返回 200 和请求结果；
- 浏览器首先发送一个请求，服务器会在响应头上设置请求的资源的上次更新时间，浏览器会缓存这个时间作为 `Last-Modified`；
- 浏览器在下次请求中，在请求头中设置了 `If-Modified-Since: [x]` ，服务器根据浏览器发送的 `x` 与自己的 `Last-Modified` 进行对比，若一致则返回空响应，减少请求的消耗，否则返回新的资源和响应；

`ETag` 和 `If-None-Match` 和上述的原理类似，为了解决误差的问题，从判断时间改为判断资源的版本号等信息。

- 第一次请求时，服务器会在响应头上的设置 `ETag` 的值（版本号、时间戳的哈希值等等）然后发给浏览器;
- 浏览器收到 `ETag` 的值缓存在 `If-None-Match` 中，在以后的资源请求中，浏览器向服务器发送 `If-None-Match: [x]`，服务器通过对比浏览器的 `x` 和自己的 `ETag` 的值判断资源是否需要重新发送。
